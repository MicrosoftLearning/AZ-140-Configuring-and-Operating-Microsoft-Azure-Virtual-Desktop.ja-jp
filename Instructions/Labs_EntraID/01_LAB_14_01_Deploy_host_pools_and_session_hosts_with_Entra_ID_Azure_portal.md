---
lab:
  title: 'ラボ: Azure portal を使用してホスト プールとセッション ホストをデプロイする (Entra ID)'
  module: 'Module 1.4: Implement host pools and session hosts'
---

# ラボ - Azure portal を使用してホスト プールとセッション ホストをデプロイする (Entra ID)
# 受講生用ラボ マニュアル

## ラボの依存関係

- このラボで使用する Azure サブスクリプション。
- このラボで使用する Azure サブスクリプションの所有者ロールを持ち、その Azure サブスクリプションに関連付けられた Entra テナントにデバイスを参加させるのに十分なアクセス許可を持つ Microsoft Entra ユーザー アカウント。

## 推定所要時間

30 分

## ラボのシナリオ

Microsoft Azure のサブスクリプションを所有しています。 Microsoft Entra 参加済みセッション ホストを使用する Azure Virtual Desktop 環境をデプロイする必要があります。

## 目標
  
このラボを完了すると、次のことができるようになります。

- Microsoft Entra 参加済み Azure Virtual Desktop セッション ホストをデプロイする

## ラボ ファイル

- なし

## 手順

### 演習 1: Microsoft Entra 参加済みセッション ホストを使用する Azure Virtual Desktop 環境を実装する
  
この演習の主なタスクは次のとおりです。

1. Azure サブスクリプションを準備して、Azure Virtual Desktop ホスト プールをデプロイする
1. Azure Virtual Desktop ホスト プールをデプロイする
1. Azure Virtual Desktop アプリケーション グループを作成する
1. Azure Virtual Desktop ワークスペースを作成する
1. Azure Virtual Desktop ホスト プールへのアクセスを許可する

#### タスク 1: Azure サブスクリプションを準備して、Azure Virtual Desktop ホスト プールをデプロイする

1. ラボ コンピューターから Web ブラウザーを起動して Azure portal ([https://portal.azure.com](https://portal.azure.com)) に移動し、このラボで使用するサブスクリプションの所有者ロールを持つユーザー アカウントの資格情報を指定してサインインします。

    > **注**: ラボ セッション ウィンドウの右側にある [リソース] タブに表示されている `User1-` アカウントの資格情報を使用します。

1. Azure portal 上の Azure Cloud Shell で PowerShell セッションを開始します。

    > **注**: メッセージが表示されたら、**[概要]** ペインの **[サブスクリプション]** ドロップダウン リストで、このラボで使用している Azure サブスクリプションの名前を選択し、**[適用する]** を選択します。

1. [Azure Cloud Shell] ペインの PowerShell セッションで、次のコマンドを実行して、**Microsoft.DesktopVirtualization** リソース プロバイダーを登録します。

    ```powershell
    Register-AzResourceProvider -ProviderNamespace Microsoft.DesktopVirtualization
    ```

    > **注**: 登録が完了するまで待つ必要はありません。 これには数分間かかることがあります。

1. [Cloud Shell] ペインを閉じます。
1. Azure portal が表示されている Web ブラウザーで **[仮想ネットワーク]** を検索して選択し、**[仮想ネットワーク]** ページで **[作成 +]** を選択します。
1. **[仮想ネットワークの作成]** ページの **[基本]** タブで、以下の設定を指定し、 **[次へ]** を選択します。

    |設定|値|
    |---|---|
    |サブスクリプション|このラボで使用している Azure サブスクリプションの名前|
    |リソース グループ|新しいリソース グループ **az140-11e-RG** の名前|
    |仮想ネットワーク名|**az140-vnet11e**|
    |リージョン|Azure Virtual Desktop 環境をデプロイする Azure リージョンの名前|

1. **[セキュリティ]** タブで、既定の設定をそのまま使用し、 **[次へ]** を選択します。
1. **[IP アドレス]** タブで、以下の設定を指定します。

    |設定|値|
    |---|---|
    |IP アドレス空間|**10.20.0.0/16**|

1. **デフォルト** サブネット エントリの横にある編集 (鉛筆) アイコンを選択し、 **Edit** ペインで次の設定を指定し (他の設定は既存の値のまま)、**保存**を選択します。

    |設定|値|
    |---|---|
    |名前|**hp1-Subnet**|
    |開始アドレス|**10.20.1.0**|
    |プライベート サブネットを有効にする (デフォルトの送信アクセスなし)|無効|

1. **IP アドレス** タブに戻り、**[確認 + 作成]** を選択し、**[確認+ 作成]** タブで **[作成]** を選択します。

    > **注**:プロビジョニング プロセスが完了するまで待たないでください。 通常、所要時間は 1 分以下です。

1. Azure portal を表示する Web ブラウザーで、 **Microsoft Entra ID**を検索して選択します。
1. サブスクリプションに関連付けられている Microsoft Entra テナントの **概要** ページの垂直ナビゲーション メニューの **管理** セクションで、 **ユーザー**を選択します。
1. **ユーザー** ページの **検索** テキスト ボックスに、ラボ セッション ウィンドウの右側にある [リソース] タブに一覧表示されている`User1-` アカウントの名前を入力します。
1. 検索結果の一覧で、一致する名前のユーザー アカウント エントリを選択します。
1. ユーザー アカウントの機能を表示するページで、バーティカル ナビゲーション メニューの **管理** セクションで、**グループ**を選択します。
1. **グループ** ページで、グループの名前を **AVD-DAG** プレフィックスで始まる名前を記録します (このラボの後半で必要になります)。
1. **ユーザー** ページに戻り、**検索** テキスト ボックスに、ラボ セッション ウィンドウの右側にある [リソース] タブに一覧表示されている `User2-` アカウントの名前を入力します。
1. 検索結果の一覧で、一致する名前のユーザー アカウント エントリを選択します。
1. ユーザー アカウントの機能を表示するページで、バーティカル ナビゲーション メニューの **管理** セクションで、**グループ**を選択します。
1. **グループ** ページで、グループの名前を **AVD-RemoteApp** プレフィックスで始めて記録します (このラボの後半で必要になります)。

#### タスク 2: Azure Virtual Desktop ホスト プールをデプロイする

1. ラボ コンピューターから Azure portal が表示されている Web ブラウザーで **[Azure Virtual Desktop]** を検索して選択し、**[Azure Virtual Desktop]** ページにある垂直ナビゲーション メニューの **[管理]** セクションで **[ホスト プール]** を選択し、**[Azure Virtual Desktop \| ホスト プール]** ページで **[+ 作成]** を選択します。 
1. **[ホスト プールの作成]** ページの **[基本]** タブで、次の設定を指定し、**[次へ: セッション ホスト]** を選択します (他は既定値のままにします)。

    |設定|値|
    |---|---|
    |サブスクリプション|このラボで使用している Azure サブスクリプションの名前|
    |リソース グループ|新しいリソース グループの名前 **az140-21e-RG**|
    |ホスト プール名|**az140-21-hp1**|
    |Location|Azure Virtual Desktop 環境をデプロイする Azure リージョンの名前|
    |検証環境|**いいえ**|
    |優先するアプリ グループの種類|**デスクトップ**|
    |ホスト プールの種類|**プールされた**|
    |セッション ホスト構成を作成する|**いいえ**|
    |負荷分散アルゴリズム|**幅優先**|

    > **注**: 幅優先の負荷分散アルゴリズムを使用する場合、最大セッション制限パラメーターは省略可能です。

1. **[ホスト プールの作成]** ページの **[セッション ホスト]** タブで、以下の設定を指定し、**[次へ: ワークスペース >]** を選択します (他の設定は既定値のままにします)。

    > **注**: **名前のプレフィックス**値を設定するときは、ラボ セッション ウィンドウの右側にある [リソース] タブに切り替え、*User1-* と *@* 文字の間の文字の文字列を識別します。 この文字列を使用して、*ランダム* プレースホルダーを置き換えます。

    |設定|Value|
    |---|---|
    |[仮想マシンの追加]|**はい**|
    |リソース グループ|**既定はホスト プールと同じ**|
    |名前のプレフィックス|**sh**-*random*|
    |仮想マシンのタイプ|**Azure 仮想マシン**|
    |仮想マシンの場所|Azure Virtual Desktop 環境をデプロイする Azure リージョンの名前|
    |可用性のオプション|**インフラストラクチャ冗長は必要ありません**|
    |セキュリティの種類|**トラステッド起動の仮想マシン**|
    |Image|**Windows 11 Enterprise マルチセッション、バージョン 23H2 + Microsoft 365 Apps**|
    |仮想マシンのサイズ|**Standard DC2s_v3**|
    |[Number of VMs](VM の数)|**2**|
    |OS ディスクの種類|**Standard SSD**|
    |OS ディスク サイズ|**既定のサイズ (128 GB)**|
    |ブート診断|**マネージド ストレージ アカウントで有効にする (推奨)**|
    |仮想ネットワーク|**az140-vnet11e**|
    |Subnet|**hp1-Subnet**|
    |ネットワーク セキュリティ グループ|**Basic**|
    |パブリック インバウンド ポート|**いいえ**|
    |参加したいディレクトリを選択する|**Microsoft Entra ID**|
    |Intune に VM を登録する|**いいえ**|
    |ユーザー名|**Student**|
    |Password|あらかじめ登録された Administrator アカウントのパスワードとして使用される任意の十分に複雑な文字列|
    |[パスワードの確認入力]|前に指定した文字列と同じ文字列|

    > **注**: パスワードの長さは 12 文字以上で、小文字、大文字、数字、特殊文字の組み合わせで構成されている必要があります。 詳細については、[Azure VM の作成時のパスワード要件](https://learn.microsoft.com/en-us/azure/virtual-machines/windows/faq#what-are-the-password-requirements-when-creating-a-vm-)に関する情報をご覧ください。

1. **[ホスト プールの作成]** ページの **[ワークスペース]** タブで、次の設定を確認し、**[確認および作成]** を選択します。

    |設定|Value|
    |---|---|
    |デスクトップ アプリ グループを登録する|**いいえ**|

1. **[ホストプールの作成]** ページの **[確認および作成]** タブで、**[作成]** を選択します。

    > **注**: デプロイが完了するまで待ちます。 これには 20 分ほどかかる場合があります。

#### タスク 3: Azure Virtual Desktop アプリケーション グループを作成する

1. ラボ コンピューターの Azure portal が表示されている Web ブラウザーで、**Azure Virtual Desktop** を検索して選択し、**[Azure Virtual Desktop]** ページで **[アプリケーション グループ]** を選択します。
1. **[Azure Virtual Desktop \| アプリケーション グループ]** ページで、自動生成された既存の **az140-21-hp1-DAG** デスクトップ アプリケーション グループを見つけて選択します。 
1. **[az140-21-hp1-DAG]** ページの縦型ナビゲーション メニューの **[管理]** セクションで、**[割り当て]** を選択します。
1. **[az140-21-hp1-DAG \| 割り当て]** ページで **[+ 追加]** を選択します。
1. **[Microsoft Entra ユーザーまたはユーザー グループの選択]** ページで、**[グループ]** を選択し、検索ボックスに、この演習の最初のタスクで特定した **AVD-DAG** グループの完全名を入力し、グループ名の横にあるチェックボックスをオンにして、**[選択]** をクリックします。
1. **[Azure Virtual Desktop \| アプリケーション グループ]** ページに戻り、**[+ 作成]** を選択します。 
1. **[アプリケーション グループの作成]** ページの **[基本]** タブで、次の設定を指定して、**[次へ: アプリケーション >]** を選択します。

    |設定|値|
    |---|---|
    |サブスクリプション|このラボで使用している Azure サブスクリプションの名前|
    |リソース グループ|**az140-21e-RG**|
    |ホスト プール|**az140-21-hp1**|
    |アプリケーション グループの種類|**リモート アプリ**|
    |アプリケーション グループ名|**az140-21-hp1-Office365-RAG**|

1. **[アプリケーション グループの作成]** ページの **[アプリケーション]** タブで、**[+ アプリケーションの追加]** を選択します。
1. **[アプリケーションの追加]** ページで、次の設定を指定し、**[確認と追加]** を選択したあと、**[追加]** を選択します。

    |設定|Value|
    |---|---|
    |アプリケーション ソース|**[スタート] メニュー**|
    |アプリケーション|**Word**|
    |[表示名]|**Microsoft Word**|
    |説明|**Microsoft Word**|
    |コマンド ライン必須|**いいえ**|

1. **[アプリケーション グループの作成]** ページの **[アプリケーション]** タブに戻り、**[+ アプリケーションの追加]** を選択します。
1. **[アプリケーションの追加]** ページで、次の設定を指定し、**[確認と追加]** を選択したあと、**[追加]** を選択します。

    |設定|Value|
    |---|---|
    |アプリケーション ソース|**[スタート] メニュー**|
    |アプリケーション|**Excel**|
    |[表示名]|**Microsoft Excel**|
    |説明|**Microsoft Excel**|
    |コマンド ライン必須|**いいえ**|

1. **[アプリケーション グループの作成]** ページの **[アプリケーション]** タブに戻り、**[+ アプリケーションの追加]** を選択します。
1. **[アプリケーションの追加]** ページで、次の設定を指定し、**[確認と追加]** を選択したあと、**[追加]** を選択します。

    |設定|Value|
    |---|---|
    |アプリケーション ソース|**[スタート] メニュー**|
    |アプリケーション|**PowerPoint**|
    |[表示名]|**Microsoft PowerPoint**|
    |説明|**Microsoft PowerPoint**|
    |コマンド ライン必須|**いいえ**|

1. **[アプリケーション グループの作成]** ページの **[アプリケーション]** タブに戻り、**[次へ: 割り当て >]** を選択します。
1. **[アプリケーション グループの作成]** ページの **[割り当て]** タブで、**[+ Microsoft Entra ユーザーまたはユーザー グループの追加]** を選択します。
1. **[Microsoft Entra ユーザーまたはユーザー グループの選択]** ページで、**[グループ]** を選択し、この演習の最初のタスクで識別した **AVD-RemoteApp** グループの完全な名前を入力し、グループ名の横にあるチェックボックスをオンにして、**[選択]** をクリックします。
1. **[アプリケーション グループの作成]** ページの **[割り当て]** タブに戻り、**[次へ: ワークスペース >]** を選択します。
1. **[ワークスペースの作成]** ページの **[ワークスペース]** タブで、次の設定を指定し、**[確認および作成]** を選択します。

    |設定|Value|
    |---|---|
    |アプリケーション グループの登録|**いいえ**|

1. **[アプリケーション グループの作成]** ページの **[確認および作成]** タブで、**[作成]** を選択します。

    > **注**: アプリケーション グループが作成されるまで待ちます。 これにかかる時間は 1 分未満です。 

    > **注**: 次に、アプリケーション ソースとしてのファイル パスに基づいてアプリケーション グループを作成します。

1. Azure portal を表示する Web ブラウザーで **Azure Virtual Desktop** を検索して選択し、**[Azure Virtual Desktop]** ページで **[アプリケーション グループ]** を選択します。
1. **[Azure Virtual Desktop \| アプリケーション グループ]** ページで、**[+ 作成]** を選択します。 
1. **[アプリケーション グループの作成]** ページの **[基本]** タブで、次の設定を指定して、**[次へ: アプリケーション >]** を選択します。

    |設定|値|
    |---|---|
    |サブスクリプション|このラボで使用している Azure サブスクリプションの名前|
    |リソース グループ|**az140-21e-RG**|
    |ホスト プール|**az140-21-hp1**|
    |アプリケーション グループの種類|**RemoteApp**|
    |アプリケーション グループ名|**az140-21-hp1-Utilities-RAG**|

1. **[アプリケーション グループの作成]** ページの **[アプリケーション]** タブで、**[+ アプリケーションの追加]** を選択します。
1. **[アプリケーションの追加]** ページの **[基本]** タブで次の設定を指定し、**[次へ]** を選択します。

    |設定|Value|
    |---|---|
    |アプリケーション ソース|**ファイル パス**|
    |アプリケーション パス|**C:\Windows\system32\cmd.exe**|
    |アプリケーション識別子|**コマンド プロンプト**|
    |[表示名]|**コマンド プロンプト**|
    |説明|**Windows コマンド プロンプト**|
    |コマンド ライン必須|**いいえ**|

1. **[アイコン]** タブで、次の設定を指定し、**[確認と追加]** を選択し、**[追加]** を選択します。

    |設定|Value|
    |---|---|
    |Icon path (アイコン パス)|**C:\Windows\system32\cmd.exe**|
    |Icon Index (アイコン インデックス)|0|

1. **[アプリケーション グループの作成]** ページの **[アプリケーション]** タブに戻り、**[次へ: 割り当て >]** を選択します。
1. **[アプリケーション グループの作成]** ページの **[割り当て]** タブで、**[+ Microsoft Entra ユーザーまたはユーザー グループの追加]** を選択します。
1. **[Microsoft Entra ユーザーまたはユーザー グループの選択]** ページで、**[グループ]** を選択し、この演習の最初のタスクで識別した **AVD-RemoteApp** グループの完全な名前を入力し、グループ名の横にあるチェックボックスをオンにして、**[選択]** をクリックします。
1. **[アプリケーション グループの作成]** ページの **[割り当て]** タブに戻り、**[次へ: ワークスペース >]** を選択します。
1. **[ワークスペースの作成]** ページの **[ワークスペース]** タブで、次の設定を指定し、**[確認および作成]** を選択します。

    |設定|Value|
    |---|---|
    |アプリケーション グループの登録|**いいえ**|

1. **[アプリケーション グループの作成]** ページの **[確認および作成]** タブで、**[作成]** を選択します。

    > **注**: アプリケーション グループが作成されるまで待ちます。 これにかかる時間は 1 分未満です。 

#### タスク 4: Azure Virtual Desktop ワークスペースを作成する

1. ラボ コンピューターの Azure portal が表示されている Web ブラウザーで、**Azure Virtual Desktop** を検索して選択し、**[Azure Virtual Desktop]** ページで **[ワークスペース]** を選択します。
1. **[Azure Virtual Desktop \| ワークスペース]** ページで、**[+ 作成]** を選択します。 
1. **[ワークスペースの作成]** ページの **[基本]** タブで、次の設定を指定して、**[次へ: アプリケーション グループ >]** を選択します。

    |設定|値|
    |---|---|
    |サブスクリプション|このラボで使用している Azure サブスクリプションの名前|
    |リソース グループ|**az140-21e-RG**|
    |ワークスペース名|**az140-21-ws1**|
    |フレンドリ名|**az140-21-ws1**|
    |場所|このラボの最初の演習でリソースをデプロイした Azure リージョンの名前または類似したリージョンの名前|

1. **[ワークスペースの作成]** ページの **[アプリケーション グループ]** タブで、次の設定を指定します。

    |設定|Value|
    |---|---|
    |アプリケーション グループを登録する|**はい**|

1. **[ワークスペースの作成]** ページの **[ワークスペース]** タブで、**[+ アプリケーション グループの登録]** を選択します。
1. **[アプリケーション グループの追加]** ページで、**[az140-21-hp1-DAG]**、**[az140-21-hp1-Office365-RAG]**、**[az140-21-hp1-Utilities-RAG]** の各エントリの横にあるプラス記号を選択し、**[選択]** をクリックします。 
1. **[ワークスペースの作成]** ページの **[アプリケーション グループ]** タブに戻り、**[確認および作成]** を選択します。
1. **[ワークスペースの作成]** ページの **[確認および作成]** タブで、**[作成]** を選択します。

#### タスク 5: Azure Virtual Desktop ホスト プールへのアクセスを許可する

> **注**: Microsoft Entra 参加済みセッション ホストを使用する際は、Azure Virtual Desktop ユーザーと管理者に適切な Azure ロールベースのアクセス制御 (RBAC) ロールを割り当てる必要があります。 特に、セッション ホストにサインインするには *仮想マシンのユーザー ログイン* ロールが必要であり、ローカル管理者特権には *仮想マシンの管理者ログイン* ロールが必要です。 

1. ラボ コンピューターの Azure portal が表示されている Web ブラウザーで、**リソース グループ**を検索して選択し、**[リソース グループ]** ページで **[az140-21e-RG]** を選択します。
1. **[az140-21e-RG]** ページの縦型ナビゲーション メニューで、**[アクセス制御 (IAM)]** を選択します。
1. **[az140-21e-RG\|アクセス制御 (IAM)]** ページで **[+ 追加]** を選択し、ドロップダウン メニューで **[ロールの割り当ての追加]** を選択します。
1. **[ロールの割り当ての追加]** ページの **[ロール]** タブで、**[職務権限ロール]** タブが選択されていることを確認し、検索ボックスに「**仮想マシンのユーザー ログイン**」と入力し、結果の一覧で **[仮想マシンのユーザー ログイン]** を選択して、**[次へ]** を選択します。
1. **[ロールの割り当ての追加]** ページの **[メンバー]** タブで、**[ユーザー、グループ、またはサービス プリンシパル]** オプションが選択されていることを確認し、**[+ メンバーの選択]** をクリックし、**[メンバーの選択]** ペインで、この演習の最初のタスクで特定した **AVD-RemoteApp** グループを見つけて、**[選択]** をクリックします。
1. **[ロールの割り当ての追加]** ページの **[メンバー]** タブに戻り、**[次へ]** を選択します。
1. **[ロールの割り当ての追加]** ページの **[割り当ての種類]** タブで、**[割り当ての種類]** を **[アクティブ]** に設定したあと、**[確認と割り当て]** を選択します。
1. **[ロールの割り当ての追加]** ページの **[確認と割り当て]** タブで、**[確認と割り当て]** を選択します。 
1. **[az140-21e-RG\|アクセス制御 (IAM)]** ページに戻り、**[+ 追加]** を選択して、ドロップダウン メニューで **[ロールの割り当てを追加]** を選択します。
1. **[ロールの割り当ての追加]** ページの **[ロール]** タブで、**[職務権限ロール]** タブが選択されていることを確認し、検索ボックスに「**仮想マシンの管理者ログイン**」と入力し、結果の一覧で **[仮想マシンの管理者ログイン]** を選択して、**[次へ]** を選択します。
1. **[ロールの割り当ての追加]** ページの **[メンバー]** タブで、**[ユーザー、グループ、またはサービス プリンシパル]** オプションが選択されていることを確認し、**[+ メンバーの選択]** をクリックし、**[メンバーの選択]** ペインで、この演習の最初のタスクで特定した **AVD-DAG** グループを見つけて、**[選択]** をクリックします。
1. **[ロールの割り当ての追加]** ページの **[メンバー]** タブに戻り、**[割り当ての種類]** を **[アクティブ]** に設定し、**[確認と割り当て]** を選択してから、もう一度 **[確認と割り当て]** を選択します。 
